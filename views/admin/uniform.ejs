<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Add Uniform | UMS</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="/css/Uniform.css">
</head>
<body>

  <div id="sidebar">
    <div>
      <div class="brand">
        <img src="/images/logo_college.png" alt="UMS Logo" />
        <h5>Uniform Management System</h5>
      </div>
      <ul class="nav flex-column nav-links mt-3">
        <li class="nav-item"><a href="/admin/index" class="nav-link"><i class="bi bi-speedometer2"></i> Dashboard</a></li>
        <li class="nav-item"><a href="/admin/uniform" class="nav-link active"><i class="bi bi-plus-lg"></i> Add Uniform</a></li>
        <li class="nav-item">
          <a href="/admin/collection" class="nav-link"><i class="bi bi-collection"></i> Uniforms</a>
        </li>
        <li class="nav-item"><a href="/admin/users" class="nav-link"><i class="bi bi-people"></i> Users</a></li>
        <li class="nav-item"><a href="/admin/request" class="nav-link"><i class="bi bi-inbox"></i> Uniform Requests</a></li>
        <li class="nav-item">
            <a href="/admin/history" class="nav-link">
            <i class="bi bi-clock-history"></i> History
            </a>
        </li>
      </ul>
    </div>

    <div class="sidebar-footer">
      <button id="logoutBtn" class="logout-btn d-flex align-items-center justify-content-center gap-2">
        <i class="bi bi-box-arrow-right"></i> Logout
      </button>
    </div>
  </div>

  <div class="main-content">
    <h2>Add New Uniform</h2>
    <hr>
    <div class="container mt-4">

      <form action="/admin/uniform" id="uniformForm" method="POST" enctype="multipart/form-data" class="p-4 border rounded bg-light">
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="category" class="form-label">
              <span class="text-primary"><i class="bi bi-tags"></i></span> Category
            </label>
            <select name="category" id="category" class="form-select" required>
              <option value="" selected disabled>Select Category</option>
              <option value="PE">PE</option>
              <option value="Academic">Academic</option>
              <option value="Corporate">Corporate</option>
              <option value="Department Shirt">Department Shirt</option>
            </select>
          </div>

          <div class="col-md-6">
            <label for="type" class="form-label">
              <span class="text-primary"><i class="bi bi-diagram-3"></i></span> Type
            </label>
            <select name="type" id="type" class="form-select" required>
              <option value="" selected disabled>Select Type</option>
              <option value="Top">Top</option>
              <option value="Bottom">Bottom</option>
            </select>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="size" class="form-label">
              <span class="text-primary"><i class="bi bi-rulers"></i></span> Size
            </label>
            <select name="size" id="size" class="form-select" required>
              <option value="" selected disabled>Select Size</option>
              <option value="XS">XS</option>
              <option value="S">S</option>
              <option value="M">M</option>
              <option value="L">L</option>
              <option value="XL">XL</option>
              <option value="XXL">XXL</option>
            </select>
          </div>

          <div class="col-md-6">
            <label for="gender" class="form-label">
              <span class="text-primary"><i class="bi bi-person"></i></span> Gender
            </label>
            <select name="gender" id="gender" class="form-select" required>
              <option value="" selected disabled>Select Gender</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
            </select>
          </div>
        </div>

        <div class="row mb-3" id="yearLevelContainer">
          <div class="col-md-6">
            <label for="yearLevel" class="form-label">
              <span class="text-primary"><i class="bi bi-mortarboard"></i></span> Year Level
            </label>
            <select name="yearLevel" id="yearLevel" class="form-select">
              <option value="" selected disabled>Select Year Level</option>
              <option value="1st Year">1st Year</option>
              <option value="2nd Year">2nd Year</option>
              <option value="3rd Year">3rd Year</option>
              <option value="4th Year">4th Year</option>
            </select>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="availability" class="form-label">
              <span class="text-primary"><i class="bi bi-toggle-on"></i></span> Availability
            </label>
            <select name="availability" id="availability" class="form-select" required>
              <option value="Available">Available</option>
              <option value="Not Available">Not Available</option>
            </select>
          </div>

          <div class="col-md-6">
            <label for="image" class="form-label">
              <span class="text-primary"><i class="bi bi-image"></i></span> Upload Image
            </label>
            <input type="file" name="image" id="image" class="form-control">
          </div>
        </div>

        <div class="text-end">
          <button type="submit" class="btn btn-primary">
            <span class="text-white"><i class="bi bi-plus-circle"></i></span> Add Uniform
          </button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/js/Logout.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const categorySelect = document.getElementById('category');
      const yearContainer = document.getElementById('yearLevelContainer');
      const yearSelect = document.getElementById('yearLevel');

      categorySelect.addEventListener('change', () => {
        const category = categorySelect.value;
        yearSelect.innerHTML = '';

        if (category === 'PE' || category === 'Academic') {
          yearContainer.style.display = 'none';
          yearSelect.removeAttribute('required');
        } else if (category === 'Corporate') {
          yearContainer.style.display = 'block';
          yearSelect.setAttribute('required', true);
          yearSelect.innerHTML = `
            <option value="3rd Year">3rd Year</option>
            <option value="4th Year">4th Year</option>
          `;
        } else if (category === 'Department Shirt') {
          yearContainer.style.display = 'block';
          yearSelect.setAttribute('required', true);
          yearSelect.innerHTML = `
            <option value="1st Year">1st Year</option>
            <option value="2nd Year">2nd Year</option>
            <option value="3rd Year">3rd Year</option>
            <option value="4th Year">4th Year</option>
          `;
        }
      });
    });

    document.getElementById('uniformForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const form = e.target;
      const formData = new FormData(form);

      try {
        const res = await fetch('/admin/uniform', {
          method: 'POST',
          body: formData
        });

        const data = await res.json();

        if (data.success) {
          Swal.fire({
            icon: 'success',
            title: 'Uniform Added Successfully!',
            text: 'The uniform has been saved to the system.',
            showConfirmButton: false,
            timer: 1500
          });

          form.reset();
        } else {
          Swal.fire({
            icon: 'error',
            title: 'Failed to Add',
            text: data.message || 'An error occurred.',
            showConfirmButton: true
          });
        }
      } catch (err) {
        Swal.fire({
          icon: 'error',
          title: 'Server Error',
          text: 'Something went wrong. Please try again later.',
          showConfirmButton: true
        });
      }
    });
  </script>
</body>
</html>
